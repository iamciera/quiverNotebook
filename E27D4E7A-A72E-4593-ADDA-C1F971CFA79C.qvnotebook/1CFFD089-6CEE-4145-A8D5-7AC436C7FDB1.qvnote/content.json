{
  "title": "Analysis 6 - Montium eve for MS2",
  "cells": [
    {
      "type": "code",
      "language": "sh",
      "data": "# in chain folder\n\nfor filename in *chain; do ~/genomicsTools/liftOver/liftOver -minMatch=0.1 -multiple ../../pipeline_output_6/1.eveRegions_forMS2.bed $filename ../../pipeline_output_6/2.liftOver/output.$filename.bed ../../pipeline_output_6/2.liftOver/unlifted.$filename.bed; done\n\n# all were lifted.\n\nfor file in stage*; do awk 'BEGIN{OFS=\"\\t\"}{print $0, FILENAME}' $file > fixed.$file; done\n\ncat fixed.output.Dmel_to_MEMB00* > 2a.liftover_output_ALL.bed\n\n# clean up bedfile name.  `2.cleanLiftOverOutputBedfile.R` In R.  Make sure you change which filename is cleaned and the output in source file. The output is `2b.outputForFastaFromBED.bed`\n\n# in asemblies folder\n\nfor filename in *.fa; do ~/genomicsTools/bedtools2/bin/fastaFromBed -fi $filename -bed ../../pipeline_output_6/2.liftOver/2b.outputForFastaFromBED.bed -fo ../../pipeline_output_6/3.fasta_creation/fastaFromBED_output_$filename -name; done\n\n# Then concatenate:`cat fastaFromBED_output_MEMB00* > 3a.fastaFromBED_ALL.fa`\n    to check: `grep -c \"^>\" 3a.fastaFromBed_ALL.fa`\n    to check in full directory: `grep -rc \"^>\" *`\n\n# add dmel\n# I ran into some problems and it seems like hand making bed files in excel causes formatting problems so beware need to figure out why. Anyway outputting the file in R with this command:\nwrite.table(kvon,\"../data/pipeline_output_6/1.eveRegions_forMS2_for_mel.bed\",col.names=F,row.names=F,sep=\"\\t\",quote=F)\n\n# Fixes everything.  Then you can run \n~/genomicsTools/bedtools2/bin/fastaFromBed -fi ../../montium_data/assemblies/dm6.fa -bed ../1.kvon_redfly_BED4_full_17May2016.bed -fo fastaFromBED_dm6_test.fa -name\n\ncat fastaFromBED_dm6.fa >> 3b.fastaFromBED_ALL.fa\n\n# Subset fasta file by presence of + or - in header\n\n# for plus \n\ncat 3a.fastaFromBed_ALL.fa | bioawk -cfastx ' $name ~ /'\\\\+'/ { print \">\" $name \"\\n\" $seq }' >> plus.fa\n\n# for minus \n\ncat 3a.fastaFromBed_ALL.fa | bioawk -cfastx ' $name ~ /\\|\\-/ { print \">\" $name \"\\n\" $seq }' >> minus.fa\n\n# Reverse Complement\n\n~/genomicsTools/seqtk/seqtk seq -r minus.fa > reversed_minus.fa\n\n# concatenate\n\ncat reversed_minus.fa plus.fa > 3b.fastaFromBED_ALL.fa\n\n# Filter all enhancers of a particular type into their own file\n\n# Gets list of unique enhancerNames\n\ncat 3b.fastaFromBed_ALL.fa | bioawk -c fastx ' $name  { print $name }' | grep -o '^[^|]*' | sed '/^\\s*$/d' | sort | uniq > enhancerNames\n\n# Extract enhancer sequences based on enhancer names\n\nwhile read line; do cat 3b.fastaFromBed_ALL.fa | bioawk -cfastx ' $name ~ /'$line'/ { print \">\" $name \"\\n\" $seq }' >> ../4.enhancer_alignment/$line.fa; done < enhancerNames\n\n\n\n"
    }
  ]
}